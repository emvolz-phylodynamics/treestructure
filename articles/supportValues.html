<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Node support values using treestructure • treestructure</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Node support values using treestructure">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">treestructure</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/treestructure.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><a class="dropdown-item" href="../articles/supportValues.html">Node support values</a></li>
    <li><a class="dropdown-item" href="../articles/updating_treestructure.html">Updating a treestructure object</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/emvolz-phylodynamics/treestructure/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Node support values using treestructure</h1>
                        <h4 data-toc-skip class="author">Vinicius Franceschi and Fabricia F. Nascimento</h4>
            
            <h4 data-toc-skip class="date">2025-09-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/emvolz-phylodynamics/treestructure/blob/master/vignettes/supportValues.Rmd" class="external-link"><code>vignettes/supportValues.Rmd</code></a></small>
      <div class="d-none name"><code>supportValues.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introductions">Introductions<a class="anchor" aria-label="anchor" href="#introductions"></a>
</h2>
<p>This tutorial uses the public data available for Ebola <a href="https://github.com/ebov/space-time" class="external-link">here</a> to demonstrate the use of node support
values (e.g. bootstrap and posterior probability) to avoid designating population
structure in badly supported clades.</p>
<p>We will use their <a href="https://github.com/ebov/space-time/blob/master/Data/Makona_1610_cds_ig.GLM.MCC.tree" class="external-link">time-scaled phylogenetic tree</a> estimated with <a href="https://beast.community" class="external-link">BEAST</a>.</p>
<p>First, we need to load the R package we will use in this tutorial.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/contribution-tree-data/" class="external-link">treeio</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.amazon.com/Integration-Manipulation-Visualization-Phylogenetic-Computational-ebook/dp/B0B5NLZR1Z/" class="external-link">ggtree</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emvolz-phylodynamics.github.io/treestructure/">treestructure</a></span><span class="op">)</span></span></code></pre></div>
<p>Now, we will load the time-scaled phylogenetic tree with posterior probability
support values:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#get the dated tree by first downloading it from the URL below</span></span>
<span><span class="va">tree_url</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/ebov/space-time/master/Data/Makona_1610_cds_ig.GLM.MCC.tree"</span></span>
<span><span class="va">tmp_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".tree"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Download BEAST tree to a tmp file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">tree_url</span>, <span class="va">tmp_file</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#read the downloaded tree</span></span>
<span><span class="va">beast_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/treeio/man/beast-parser.html" class="external-link">read.beast</a></span><span class="op">(</span><span class="va">tmp_file</span><span class="op">)</span></span></code></pre></div>
<p>Then we need to convert the tree to a <code>phylo</code> object and add the posterior
probability information from the Bayesian tree to the <code>phylo</code> object tree.</p>
<p>If we use the <code>ape:read.nexus</code> to read the tree that was estimated with BEAST,
we won’t get the posterior probability associated to the clades.</p>
<p>We now convert the dated tree to <code>phylo</code> object.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dated_tre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/as.phylo.html" class="external-link">as.phylo</a></span><span class="op">(</span><span class="va">beast_tree</span><span class="op">)</span></span></code></pre></div>
<p>Now we add the posterior probability from the BEAST tree to the dated_tree
object.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get number of tips</span></span>
<span><span class="va">n_tips</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dated_tre</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get BEAST tree as tibble (it will include node numbers and posterior probabilities)</span></span>
<span><span class="va">tree_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">beast_tree</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#get posterior probability</span></span>
<span><span class="va">posterior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">tree_data</span><span class="op">$</span><span class="va">posterior</span><span class="op">[</span><span class="op">(</span><span class="va">n_tips</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">tree_data</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#add the posterior probability information to the `phylo` object</span></span>
<span><span class="va">dated_tre</span><span class="op">$</span><span class="va">node.label</span> <span class="op">&lt;-</span> <span class="va">posterior</span></span></code></pre></div>
<div class="section level3">
<h3 id="assign-clusters-without-using-node-support">Assign clusters without using node support<a class="anchor" aria-label="anchor" href="#assign-clusters-without-using-node-support"></a>
</h3>
<p>Firstly, we will assign clusters without using node support values. Note that
the parameter <code>nodeSupportValues</code> is set to FALSE.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trestruct_res_nobt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trestruct.html">trestruct</a></span><span class="op">(</span><span class="va">dated_tre</span>, </span>
<span>                                minCladeSize <span class="op">=</span> <span class="fl">30</span>, </span>
<span>                                nodeSupportValues <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                                level <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span></code></pre></div>
<p>Because <code>treestructure</code> will take several minutes to run, we can load the results:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trestruct_res_nobt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'trestruct_res_nobt.rds'</span>,</span>
<span>                                           package<span class="op">=</span><span class="st">'treestructure'</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">trestruct_res_nobt</span>, use_ggtree <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtree</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tippoint.html" class="external-link">geom_tippoint</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="supportValues_files/figure-html/unnamed-chunk-6-1.png"><!-- --></p>
<p>The <code>treestructure</code> analyses resulted in 23 clusters.</p>
</div>
<div class="section level3">
<h3 id="assign-clusters-using-branch-support">Assign clusters using branch support<a class="anchor" aria-label="anchor" href="#assign-clusters-using-branch-support"></a>
</h3>
<p>Now, we will assign clusters using the information on branch support.
As we are analyzing a dated tree estimated with BEAST, the branch support is
the posterior probability.</p>
<p>We designate clusters that have at least 0.95 posterior probability. This
is achieved by setting to 95 the parameter <em>nodeSupportThreshold</em> in the <strong>trestruct</strong>
function.</p>
<p>Note that now the parameter <code>nodeSupportValues</code> is set to TRUE, which tells
the algorithm that the node support values is provided with the <code>phylo</code> object
as <code>node.label</code>.</p>
<p>You can also provide the <code>nodeSupportValues</code> as a vector with length equal to
the number of internal nodes in the tree.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trestruct_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trestruct.html">trestruct</a></span><span class="op">(</span><span class="va">dated_tre</span>, </span>
<span>                           minCladeSize <span class="op">=</span> <span class="fl">30</span>, </span>
<span>                           nodeSupportValues <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                           nodeSupportThreshold <span class="op">=</span> <span class="fl">95</span>, </span>
<span>                           level <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span></code></pre></div>
<p>Because it will take a minute or so to run <code>treestructure</code>, we can load the result
instead.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trestruct_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'trestruct_res.rds'</span>,</span>
<span>                                      package<span class="op">=</span><span class="st">'treestructure'</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">trestruct_res</span>, use_ggtree <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtree</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tippoint.html" class="external-link">geom_tippoint</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="supportValues_files/figure-html/unnamed-chunk-8-1.png"><!-- --></p>
<p>Now we have only 6 well-supported clusters with differences in coalescent patterns.</p>
<p>Note that this might change if you use a higher or lower value for the
<em>nodeSupportThreshold</em> in the <strong>trestruct</strong> function.</p>
</div>
<div class="section level3">
<h3 id="using-the-ch-index">Using the CH-index<a class="anchor" aria-label="anchor" href="#using-the-ch-index"></a>
</h3>
<p>The CH-index will compare different values for the parameter <code>levels</code> in the
<code>treestructure</code> algorithm. We will need to specify <code>level</code> = NULL and
specify the lower and upper bound to optimize the parameter <code>level</code>.</p>
<p>Note that we will also take into consideration the use of branch support.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">trestruct_chindex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trestruct.html">trestruct</a></span><span class="op">(</span><span class="va">dated_tre</span>,</span>
<span>                               minCladeSize <span class="op">=</span> <span class="fl">30</span>, </span>
<span>                               nodeSupportValues <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                               nodeSupportThreshold <span class="op">=</span> <span class="fl">95</span>,</span>
<span>                               level <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                               levellb <span class="op">=</span> <span class="fl">0.0001</span>, </span>
<span>                               levelub <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span></span></code></pre></div>
<p>Because it will also take a minute or so to run <code>treestructure</code>, we can load the result instead.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trestruct_chindex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'trestruct_chindex.rds'</span>,</span>
<span>                                      package<span class="op">=</span><span class="st">'treestructure'</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">trestruct_chindex</span>, use_ggtree <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtree</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tippoint.html" class="external-link">geom_tippoint</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="supportValues_files/figure-html/unnamed-chunk-10-1.png"><!-- --></p>
<p>Now we have only 2 well-supported clusters with differences in coalescent
patterns after optimizing the significance level.</p>
<p>In this example, instead of using level = 0.01 (as in the default ), the optimization
of level by using the CH-index identified level as 0.00073.</p>
<div class="section level4">
<h4 id="final-considerations">Final considerations<a class="anchor" aria-label="anchor" href="#final-considerations"></a>
</h4>
<p>The function <code>trestruct</code> has a parameter named <code>nsim</code> that refers to the number
of simulations for computing the null distribution of the test statistics <span class="citation">(Volz et al. 2020)</span>.</p>
<p>The <code>nsim</code> parameter in the <code>trestruct</code> function is is set to the default value of
10,000, which is a good value if the level parameter is set to 0.01 (which is the
default value).</p>
<p>If decreasing the value of the level parameter, the value of <code>nsim</code> should be
increased. In the above example using CH-index, the algorithm identified a
significance level of 0.00073. However, the analyses were carried out using the
default <code>nsim</code> of 10,000 simulations. We have future plans to automatically detect
the adequate number of simulations (<code>nsim</code> value) given the sizes of clades being
compared and the threshold p-value used in the test.</p>
<p>As treestructure is implemented in the moment, you should run a sensitive analyses
on your own dataset, if you use a significance level smaller than 0.01. For example,
if you use a significance <code>level</code> of 0.001 and a <code>nsim</code> &gt; 10,000, then you can run your analysis twice and compare the results obtained in both runs, which should be very similar.
If results are very different, you should increase the value of <code>nsim</code>.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Volz2020" class="csl-entry">
Volz, EM, W Carsten, YH Grad, SDW Frost, AM Dennis, and X Didelot. 2020. <span>“Identification of Hidden Population Structure in Time-Scaled Phylogenies.”</span> <em>Systematic Biology</em> 69: 884–96. <a href="https://doi.org/10.1093/sysbio/syaa009" class="external-link">https://doi.org/10.1093/sysbio/syaa009</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>
Website developed by <a href="https://profiles.imperial.ac.uk/f.ferreira-do-nascimento" class="external-link">Fabricia F. Nascimento</a>
</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
